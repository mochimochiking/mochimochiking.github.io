

<!DOCTYPE html>
<!-- saved from url=(0048)https://mochimochiking.github.io/youtubeImg.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title></title>
<style>
  *{
    font-size: 20px;
    margin: 0px;
    padding: 0px;
  }
  td{
    vertical-align: top;
  }
</style>
</head>
<body bgcolor="#eee">
<table><tbody><tr><td><canvas id="canvas1" width="1280" height="720"></canvas></td>
<td><form name="form1">
  背景色:<input type="text" name="bgColor" value="white"><br>
  背景:<input type="text" name="flg" value="https://www.rings.jp/images/image_space.png">
  拡大<input type="checkbox" name="zoom" value="zoom" checked><br>
  <!-- 国章:<input type="text" name="emb" value=" "><br> -->
  タイトル:<input type="text" name="title" value=""><br>
  日本語タイトル:<input type="text" name="titleJa" value=""><br>
  下の文1:<input type="text" name="sita1" value=""><br>
  下の文2:<input type="text" name="sita2" value=""><br>
  歌詞:<textarea name="lyr" rows="4" cols="80">


  </textarea><br>
  歌詞:<textarea name="lyr2" rows="4" cols="80" autocomplete="off">


  </textarea><br>
  和訳:<textarea name="lyrJa" rows="4" cols="80">


</textarea><br>
  太さ:<input type="range" name="isBold" min="100" max="900" step="100" value="500"><br>
  状態:<select name="type">
    <option value="title">タイトル</option>
    <option value="main4" selected="">メイン</option>
  </select><br>
  フォント:<select name="font">
    <option value="Arial Rounded MT">Arial Rounded MT</option>
    <option value="Calibri">Calibri</option>
    <option value="candara">candara</option>
    <option value="Segoe UI">Segoe UI</option>
    <option value="Arial">Arial</option>
    <option value="Cambria" selected="">Cambria</option>
    <option value="Sitka Text">Sitka Text</option>
    <option value="Georgia">Georgia</option>
    <option value="Century">Century</option>
    <option value="Courier New">Courier New</option>
    <option value="Times New Roman">Times New Roman</option>
    <option value="Palatino Linotype">Palatino Linotype</option>
    <option value="Constantia">Constantia</option>
    <option value="Sylfaen">Sylfaen</option>
    <option value="Garamond">Garamond</option>
    <option value="Mistral">Mistral</option>
    <option value="Segoe print">Segoe print</option>
    <option value="Segoe script">Segoe script</option>
    <option value="Monotype Corsiva">Monotype Corsiva</option>
    <option value="Lucida Sans Unicode">Lucida Sans Unicode(unicode)</option>
    <option value="Arial Unicode MS">Arial Unicode MS(unicode)</option>
    <option value="Nirmala UI">Nirmala UI(インド)</option>
    <option value="karma">karma(ヒンディー)</option>
    <option value="aldhabi">aldhabi(ナスタアリーク)</option>
    <option value="FangSong">FangSong(中華)</option>
    <option value="KaiTi">Kaiti(中華)</option>
    <option value="丁永康硬笔楷书新版">丁永康硬笔楷书新版(中華)</option>
    <option value="simhei">simhei(中華)</option>
    <option value="simsun">simsun(中華)</option>
    <option value="PKS BG Galpil">PKS BG Galpil(朝鮮)</option>
    <option value="KP PusKul">KP PusKul(朝鮮)</option>
    <option value="KP CheongPong">KP CheongPong(朝鮮)</option>
    <option value="KP KwangMyeong">KP KwangMyeong(朝鮮)</option>
    <option value="Source Han Sans KR">Source Han Sans KR(韓国)</option>
    <option value="BM DoHyeon">BM DoHyeon(韓国)</option>
    <option value="BM JUA_TTF">BM JUA_TTF(韓国)</option>
    <option value="tvN Enjoystories">tvN Enjoystories(韓国)</option>
    <option value="Source Han Serif K">Source Han Serif K(韓国)</option>
    <option value="OSeong and HanEum">OSeong and HanEum(韓国)</option>
    <option value="NanumGothicOTF">NanumGothicOTF(韓国)</option>
    <option value="NanumMyeongjo">NanumMyeongjo(韓国)</option>
    <option value="Batang">Batang(韓国)</option>
    <option value="HGP明朝E">HGP明朝E(日本)</option>
    <option value="Noto Sans JP">Noto Sans(日本)</option>
    <option value="Noto Sans KR">Noto Sans(韓国)</option>
    <option value="Noto Sans SC">Noto Sans(中国)</option>
    <option value="Noto Sans">Noto Sans</option>
  </select><br>
  イタリック:<select name="italic">
    <option value="italic">yes</option>
    <option value="" selected>no</option>
  </select><br>
  文字色:<select name="color">
    <option value="black">black</option>
    <option value="white" selected>white</option>
    <option value="yellow">yellow</option>
  </select><br>
  alpha:<select name="alpha">
    <option value="0">0</option>
    <option value="0.25">0.25</option>
    <option value="0.5">0.5</option>
  </select><br>
  フォントサイズ：<input type="range" name="fontSize" min="50" max="70" step="5" value="65"><br>
  スペーシング：<input type="range" name="spacing" min="-25" max="5" step="5" value="-10"><br>
</form></td></tr></tbody></table>
<script>
function update(){
  let s = 1

  let bgColor = document.form1.bgColor.value;
  let flg = document.form1.flg.value;
  let title = document.form1.title.value;
  let titleJa = document.form1.titleJa.value;
  let sita1 = document.form1.sita1.value;
  let sita2 = document.form1.sita2.value;
  let text = document.form1.lyr.value.split("\n");
  let text2 = document.form1.lyr2.value.split("\n");
  let ja = document.form1.lyrJa.value.split("\n");
  let isBold = document.form1.isBold.value;
  let type = document.form1.type.value;
  let font = document.form1.font.value;
  let jpFont = "HGP明朝E";
  let italic = document.form1.italic.value;
  let color = document.form1.color.value;
  let alpha = document.form1.alpha.value;
  let fontSize = document.form1.fontSize.value;
  let spacing = document.form1.spacing.value;

  let ctx = document.getElementById("canvas1").getContext('2d');

  let img = new Image();
  img.src = flg;
  img.onload = () => {
    ctx.clearRect(0, 0, 1280*s, 720*s);
    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, 1280*s, 720*s);//120*16, 120*9

    let x,w;
    x=0*s;
    w=1280*s;
    ctx.shadowBlur = 0;
    
    if((img.width/img.height>16/9&&!document.form1.zoom.checked)||(img.width/img.height<16/9&&document.form1.zoom.checked)){
      ctx.drawImage(img, 0, (720*s-1280*s*img.height/img.width)/2, 1280*s, 1280*s*img.height/img.width);
    }else{
      ctx.drawImage(img, (1280*s-720*s*img.width/img.height)/2, 0, 720*s*img.width/img.height, 720*s);
    }

    if(type=="title"){
      ctx.fillStyle = color;
      ctx.shadowColor = color=="black"?"white":"black";//影
      ctx.shadowBlur = 20*s;
      ctx.textAlign = "center";
      ctx.font = "160px serif";
      ctx.font = "160px \""+font+"\"";

      ctx.font = "120px \""+jpFont+"\""; //(旧)
      ctx.fillText(sita1, 640*s, 540*s, 1200*s); //(旧)
      ctx.fillText(sita2, 640*s, 680*s, 1200*s); //(旧)

      ctx.textAlign = "left";
      ctx.font = "135px \""+font+"\"";
      ctx.fillText(title, 40*s, 540*s, 1200*s);
      ctx.font = "120px \""+jpFont+"\""
      ctx.fillText(titleJa, 40*s, 680*s, 1200*s);

    }else if(type=="main4"){
      ctx.fillStyle = color=="black"?"white":"black";
      ctx.globalAlpha = alpha;
      ctx.fillRect(0*s, 0, 1280*s, 720*s);


      ctx.globalAlpha = 1;
      

      ctx.shadowColor = color=="black"?"white":"black";//影

      for(let i=1; i<=2; i++){
        ctx.shadowBlur = 10;
        ctx.textAlign = "left";
        ctx.fillStyle = color;
        ctx.font = italic+" "+isBold+" "+fontSize+"px \""+font+"\"";
        ctx.fillText(removeRuby(text[0]), x+40*s,  70*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text[1]), x+40*s, 250*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text[2]), x+40*s, 430*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text[3]), x+40*s, 610*s+spacing*s, w-80*s);

        for(let row=0; row<4; row++){
          const re = /(?<=\().*?\|.*?(?=\))/g;
          while(true){
            let exec = re.exec(text[row]);
            if(!exec){
              break;
            }
            ctx.textAlign = "left";
            ctx.font = italic+" "+isBold+" "+fontSize+"px \""+font+"\"";
            let width = ctx.measureText(removeRuby(text[row].substring(0, exec.index-1))).width + ctx.measureText(exec[0].split("|")[0]).width/2;

            ctx.textAlign = "center";
            ctx.shadowBlur = 3;
            ctx.font = "20px \"BIZ UDPゴシック\"";
            ctx.fillText((exec[0].split("|")[1]), x+40*s+width, (180*row+82.5)*s-fontSize+spacing*s, w-80*s);
            console.log(width, exec[0].split("|")[1])
          }
          
        }
        
        ctx.shadowBlur = 10;
        ctx.textAlign = "left";
        ctx.fillStyle = color;
        // ctx.font = "35px \"Noto Sans\", \"BIZ UDPゴシック\"";
        ctx.font = "bold 35px \"BIZ UDPゴシック\"";
        // ctx.font = "35px \"HGP明朝E\"";

        ctx.fillText(removeRuby(text2[0]), x+45*s, 120*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text2[1]), x+45*s, 300*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text2[2]), x+45*s, 480*s+spacing*s, w-80*s);
        ctx.fillText(removeRuby(text2[3]), x+45*s, 660*s+spacing*s, w-80*s);

        ctx.globalAlpha = 1;
        ctx.font = "45px \"UD デジタル 教科書体 NK-R\"";
        ctx.font = "45px \"HGP明朝E\", \"Source Han Serif K\"";
        ctx.fillText(removeRuby(ja[0]), x+40*s, 170*s+spacing*s, w-40*s);
        ctx.fillText(removeRuby(ja[1]), x+40*s, 350*s+spacing*s, w-40*s);
        ctx.fillText(removeRuby(ja[2]), x+40*s, 530*s+spacing*s, w-40*s);
        ctx.fillText(removeRuby(ja[3]), x+40*s, 710*s+spacing*s, w-40*s);
        
      }

      ctx.globalAlpha = 1;
    }
  }
}

function removeRuby(str){
  if(str === undefined){
    return "";
  }
  return str.replace(/\((.*?)\|.*?\)/g, "$1");
}

for(let i of document.form1.getElementsByTagName("*")){
  if(i.tagName!="BR"){
    i.addEventListener("input", ()=>{update();});
  }
}
window.onload = ()=>{update();};
</script>
